# phpMyAdmin 4.0.x—4.6.2 Remote Code Execution Vulnerability (CVE-2016-5734)

phpMyAdmin is an open source, web-based MySQL database management tool. In the function of finding and replacing strings, the information input by the user is spliced ​​into the first parameter of the `preg_replace` function.

Prior to PHP 5.4.7, the first argument to `preg_replace` could be truncated with \0 and the regular pattern changed to e. As we all know, the e-mode regex supports execution code, in which case an arbitrary code execution vulnerability can be constructed.

The following versions are affected:

- 4.0.x version before 4.0.10.16
- Version 4.4.x prior to 4.4.15.7
- Version 4.6.3 before 4.6.3 (actually because this version requires PHP5.5+, this vulnerability cannot be reproduced)

## Environment Building

Run the following command to start PHP 5.3 + Apache + phpMyAdmin 4.4.15.6:

```
Docker-compose up -d
```

After launching, visit `http://your-ip:8080` and you will see the login page of phpMyAdmin. Log in with `root`:`root`.

## Vulnerability recurrence

This feature requires login and is able to write data.

Because the target environment uses root, we can create a temporary database and data table for exploits. Here, we use POC https://www.exploit-db.com/exploits/40185/ to reproduce the vulnerability.

```
./cve-2016-5734.py -c 'system(id);' -u root -p root -d test http://your-ip:8080/
```

![](1.png)

-d is a database that can be written, -c is the PHP statement to be executed. If no table name is specified, the POC will create a table named `prgpwn`.