# Airflow 1.10.10 CVE-2020-11978 - RCE/command execution in example dag



[中文版本(Chinese version)](./README.zh-cn.md)

Airflow is an open source, distributed task scheduling framework. It assembles a workflow with subordinate and subordinate dependencies into a directed acyclic graph.

The 1.10.10 docker-compose file is modified from the docker-compose file provided by airflow 2.x.

Airflow configuration uses CeleryExecutor for task execution, so the command execution result needs to be viewed in the CeleryWorker  container.

Since there are many components to be started, it may be a bit stuck. Please prepare more than 2G of memory for the use of the virtual machine.

## Vulnerability Environment

Execute the following commands to start airflow 1.10.10

```bash
#Initialize the database
docker-compose run airflow-init initdb
#Start service
docker-compose up -d
```

## Exploit

Visit `http://host:8080` to enter the airflow management terminal, and change the Off in front of `example_trigger_target_dag` to On:

![image-20210701142307744](README.assets/image-20210701142307744.png)

Then click the Triger button and enter in `Configuration JSON`: `{"message":"'\";touch /tmp/airflow_dag_success;#"}`, then click `Trigger` to execute dag

![image-20210701142758977](README.assets/image-20210701142758977.png)

Wait a few seconds to see the execution of `success`

![image-20210701142948275](README.assets/image-20210701142948275.png)

Go to the CeleryWorker container to view:

```
docker-compose exec airflow-worker ls -l /tmp
```

You can see that the airflow_dag_success file was successfully created:

![image-20210701154024308](README.assets/image-20210701154024308.png)

## Reference

https://docs.celeryproject.org/en/stable/userguide/configuration.html

https://www.bookstack.cn/read/celery-3.1.7-zh/8d5b10e3439dbe1f.md#dhfmrk

https://docs.celeryproject.org/en/stable/userguide/calling.html#serializers

https://www.jianshu.com/p/52552c075bc0

https://www.runoob.com/w3cnote/python-redis-intro.html

https://blog.csdn.net/SKI_12/article/details/85015803
