FROM vulhub/python:3.6

MAINTAINER neargle <nearg1e.com@gmail.com>

RUN set -ex \
    && sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list \
    && sed -i 's|security.debian.org|mirrors.ustc.edu.cn/debian-security/|g' /etc/apt/sources.list \
    && apt-get update \
    && apt-get install --no-install-recommends -y wget  \
    && pip install -i  https://pypi.doubanio.com/simple/  --trusted-host pypi.doubanio.com -U pip \
    && pip install -i  https://pypi.doubanio.com/simple/  --trusted-host pypi.doubanio.com "flask==0.12.2" "Pillow==4.2.1" \
    && rm -rf /var/lib/apt/lists/*

RUN set -ex \
    && wget -qO- https://gitee.com/leehdsniper/vulhub-package/raw/master/ghostscript-9.21-linux-x86_64.tgz \
        | tar zx -C /tmp/ \
    && mkdir -p /opt/ghostscript \
    && mv /tmp/ghostscript-9.21-linux-x86_64/gs-921-linux-x86_64 /usr/local/bin/gs

COPY app.py /usr/src/

WORKDIR /usr/src/

CMD ["python", "app.py"]